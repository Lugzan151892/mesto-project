(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{j:()=>J,M:()=>F});var t=document.querySelector(".popup"),n=document.querySelector(".popup-place"),o=document.querySelector(".popup-image"),c=document.querySelector(".popup-edit-avatar"),r=c.querySelector(".popup__button"),u=t.querySelector(".popup__button"),a=document.querySelector(".profile__edit-btn"),i=document.querySelector(".popup__form"),l=document.querySelector(".profile__name"),s=document.querySelector(".profile__description"),p=document.querySelector(".profile__id"),d=document.querySelector(".profile__image"),m=document.querySelector(".profile__image-edit"),f=document.querySelector("#popup-name"),_=document.querySelector("#popup-about"),v=document.querySelector("#place").content,h=document.querySelector(".places"),y=o.querySelector(".popup-image__title"),S=o.querySelector(".popup-image__image"),b=o.querySelector(".popup__button"),q=n.querySelector(".popup__button"),k=document.querySelector(".profile__button"),g=n.querySelector(".popup__form"),C=document.querySelector("#popupAvatarForm"),E=document.querySelector("#popup-place-name"),L=document.querySelector("#popup-link"),j=document.querySelector("#popup-avatar-link"),x=document.querySelector("#popup-place-submit"),P=document.querySelector("#popup-profile-submit"),A=document.querySelector("#popup-avatar-submit"),U=(document.fonts.popupForm,{baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"0536b3c2-5810-4220-9c51-ca725c65cff7","Content-Type":"application/json"}});function T(e,t){var n=t.textContent;t.textContent=e?"Сохранение ...":n}var O=function(){return fetch("".concat(U.baseUrl,"/cards"),{method:"GET",headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},w=function(e){var t=v.querySelector(".place").cloneNode(!0),n=t.querySelector(".place__image"),c=t.querySelector(".place__delete-btn"),r=t.querySelector(".place__like-counter");n.src=e.link,n.alt=e.name,t.querySelector(".place__title").textContent=e.name,r.textContent=e.likes.length,e.owner._id!=p.textContent&&(c.setAttribute("disabled",!1),c.classList.add("place__delete-btn_inactive"));var u=p.textContent;return e.likes.some((function(e){return e._id==u}))&&t.querySelector(".place__like-btn").classList.add("place__like-btn_active"),t.querySelector(".place__like-btn").addEventListener("click",(function(t){var n;t.target.classList.toggle("place__like-btn_active"),t.target.classList.contains("place__like-btn_active")?(n=e._id,fetch("".concat(U.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){r.textContent=e.likes.length,console.log(e)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(U.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e._id).then((function(e){r.textContent=e.likes.length,console.log(e)})).catch((function(e){console.log(e)}))})),n.addEventListener("click",(function(){y.textContent=e.name,S.alt=e.name,S.src=e.link,F(o)})),c.addEventListener("click",(function(){var n;t.remove(),(n=e._id,fetch("".concat(U.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))})),t},D=function(e,t){e.prepend(t)};O().then((function(e){e.forEach((function(e){return D(h,w(e))}))})).catch((function(e){console.log(e)}));var B=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!1))};function N(e){"Escape"===e.key&&J(document.querySelector(".popup_opened"))}fetch("".concat(U.baseUrl,"/users/me"),{method:"GET",headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){l.textContent=e.name,s.textContent=e.about,d.src=e.avatar,p.textContent=e._id})).catch((function(e){console.log(e)}));var M,J=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",N)},F=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",N)};console.log(O()),document.addEventListener("mouseup",(function(e){e.composedPath()[0].className.includes("popup_opened")&&J(document.querySelector(".popup_opened"))})),i.addEventListener("submit",(function(e){var n,o;e.preventDefault(),T(!0,P),l.textContent=f.value,s.textContent=_.value,(n=f.value,o=_.value,fetch("".concat(U.baseUrl,"/users/me"),{method:"PATCH",headers:U.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){T(!1,P)})),J(t)})),g.addEventListener("submit",(function(e){e.preventDefault(),T(!0,x);var t,o,c={};c.name=E.value,c.link=L.value,c.likes=[],c.owner={},c.owner._id=p.textContent,D(h,w(c)),(t=E.value,o=L.value,fetch("".concat(U.baseUrl,"/cards"),{method:"POST",headers:U.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){T(!1,x)})),J(n)})),u.addEventListener("click",(function(){return J(t)})),a.addEventListener("click",(function(){F(t),f.value=l.textContent,_.value=s.textContent})),q.addEventListener("click",(function(){return J(n)})),k.addEventListener("click",(function(){E.value="",L.value="",F(n),x.setAttribute("disabled",!1),x.classList.add("popup__submit_inactive")})),m.addEventListener("click",(function(){F(c)})),r.addEventListener("click",(function(){return J(c)})),b.addEventListener("click",(function(){return J(o)})),C.addEventListener("submit",(function(e){var t;e.preventDefault(),T(!0,A),d.src=j.value,(t=j.value,fetch("".concat(U.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:U.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){T(!1,A)})),J(c)})),console.log(d.src),console.log(C),M={formSelector:".popup__inputs",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(M.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);B(n,o,t),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,t),B(n,o,t)}))}))}(e,M)}))})();