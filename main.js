(()=>{"use strict";var e=document.querySelector(".popup"),t=document.querySelector(".popup-place"),n=document.querySelector(".popup-image"),o=document.querySelector(".popup-edit-avatar"),c=o.querySelector(".popup__button"),r=e.querySelector(".popup__button"),u=document.querySelector(".profile__edit-btn"),a=document.querySelector(".popup__form"),i=document.querySelector(".profile__name"),l=document.querySelector(".profile__description"),s=document.querySelector(".profile__id"),p=document.querySelector(".profile__image"),d=document.querySelector(".profile__image-edit"),f=document.querySelector("#popup-name"),m=document.querySelector("#popup-about"),_=document.querySelector("#place").content,v=document.querySelector(".places"),h=n.querySelector(".popup-image__title"),y=n.querySelector(".popup-image__image"),S=n.querySelector(".popup__button"),b=t.querySelector(".popup__button"),q=document.querySelector(".profile__button"),E=t.querySelector(".popup__form"),L=document.querySelector("#popupAvatarForm"),g=document.querySelector("#popup-place-name"),k=document.querySelector("#popup-link"),C=document.querySelector("#popup-avatar-link"),x=document.querySelector("#popup-place-submit"),A=document.querySelector("#popup-profile-submit"),U=document.querySelector("#popup-avatar-submit"),T=document.querySelectorAll(".popup__input-error"),D=document.querySelectorAll(".popup__input"),P=(document.fonts.popupForm,{baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"0536b3c2-5810-4220-9c51-ca725c65cff7","Content-Type":"application/json"}});function B(e,t){t.value=e?"Сохранение ...":"Сохранить"}function N(e){"Escape"===e.key&&j(document.querySelector(".popup_opened"))}var j=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",N)},w=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",N)};document.addEventListener("mouseup",(function(e){e.composedPath()[0].className.includes("popup_opened")&&j(document.querySelector(".popup_opened"))}));var M=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!1))};function O(e,t){e.forEach((function(e){e.textContent=""})),t.forEach((function(e){e.classList.remove("popup__input_type_error")}))}function F(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var G=function(e,t,o,c){var r=_.querySelector(".place").cloneNode(!0),u=r.querySelector(".place__image"),a=r.querySelector(".place__delete-btn"),i=r.querySelector(".place__like-counter");return u.alt=e.name,u.src=e.link,r.querySelector(".place__title").textContent=e.name,i.textContent=e.likes.length,e.owner._id!==s.textContent&&(a.setAttribute("disabled",!1),a.classList.add("place__delete-btn_inactive")),e.likes.some((function(e){return e._id===s.textContent}))&&r.querySelector(".place__like-btn").classList.add("place__like-btn_active"),r.querySelector(".place__like-btn").addEventListener("click",(function(n){n.target.classList.toggle("place__like-btn_active"),n.target.classList.contains("place__like-btn_active")?t(!0,e,i):t(!1,e,i)})),u.addEventListener("click",(function(){c(h,y,e,n)})),a.addEventListener("click",(function(){r.remove(),o(e)})),r};fetch("".concat(P.baseUrl,"/users/me"),{method:"GET",headers:P.headers}).then((function(e){return F(e)})).then((function(e){i.textContent=e.name,l.textContent=e.about,p.src=e.avatar,s.textContent=e._id,H()})).catch((function(e){console.log(e)}));var J,V=function(e,t,n){var o;e?(o=t._id,fetch("".concat(P.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:P.headers}).then((function(e){return F(e)}))).then((function(e){n.textContent=e.likes.length,console.log(e)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(P.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:P.headers}).then((function(e){return F(e)}))}(t._id).then((function(e){n.textContent=e.likes.length,console.log(e)})).catch((function(e){console.log(e)}))},z=function(e){var t;(t=e._id,fetch("".concat(P.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:P.headers}).then((function(e){return F(e)}))).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},H=function(){fetch("".concat(P.baseUrl,"/cards"),{method:"GET",headers:P.headers}).then((function(e){return F(e)})).then((function(e){e.forEach((function(e){return t=v,n=G(e,V,z,I),void t.append(n);var t,n}))})).catch((function(e){console.log(e)}))},I=function(e,t,n,o){e.textContent=n.name,t.alt=n.name,t.src=n.link,w(o)};a.addEventListener("submit",(function(t){var n,o;t.preventDefault(),B(!0,A),(n=f.value,o=m.value,fetch("".concat(P.baseUrl,"/users/me"),{method:"PATCH",headers:P.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return F(e)}))).then((function(t){i.textContent=f.value,l.textContent=m.value,console.log(t),j(e)})).catch((function(e){console.log(e)})).finally((function(){B(!1,A)}))})),E.addEventListener("submit",(function(e){var n,o;e.preventDefault(),B(!0,x),(n=g.value,o=k.value,fetch("".concat(P.baseUrl,"/cards"),{method:"POST",headers:P.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return F(e)}))).then((function(e){return e})).then((function(e){var n,o,c={};c.name=g.value,c.link=k.value,n=v,o=G(e,V,z,I),n.prepend(o),j(t)})).catch((function(e){console.log(e)}))})),r.addEventListener("click",(function(){return j(e)})),u.addEventListener("click",(function(){O(T,D),B(!1,A),w(e),f.value=i.textContent,m.value=l.textContent})),b.addEventListener("click",(function(){return j(t)})),q.addEventListener("click",(function(){var e;O(T,D),B(!1,x),g.value="",k.value="",w(t),(e=x).setAttribute("disabled",!1),e.classList.add("popup__submit_inactive")})),d.addEventListener("click",(function(){O(T,D),B(!1,U),w(o)})),c.addEventListener("click",(function(){return j(o)})),S.addEventListener("click",(function(){return j(n)})),L.addEventListener("submit",(function(e){e.preventDefault(),B(!0,U),changeProfileAvatar(C.value).then((function(e){p.src=C.value,console.log(e),j(o)})).catch((function(e){console.log(e)})).finally((function(){B(!1,U)}))})),J={formSelector:".popup__inputs",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(J.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);M(n,o,t),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,t),M(n,o,t)}))}))}(e,J)}))})();