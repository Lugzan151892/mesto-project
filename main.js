(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{xe:()=>H,bn:()=>I,QK:()=>Q});var t=document.querySelector(".popup"),n=document.querySelector(".popup-place"),o=document.querySelector(".popup-image"),r=document.querySelector(".popup-edit-avatar"),c=r.querySelector(".popup__button"),u=t.querySelector(".popup__button"),i=document.querySelector(".profile__edit-btn"),a=document.querySelector(".popup__form"),l=document.querySelector(".profile__name"),s=document.querySelector(".profile__description"),p=document.querySelector(".profile__id"),d=document.querySelector(".profile__image"),f=document.querySelector(".profile__image-edit"),_=document.querySelector("#popup-name"),m=document.querySelector("#popup-about"),v=document.querySelector("#place").content,y=document.querySelector(".places"),h=o.querySelector(".popup-image__title"),S=o.querySelector(".popup-image__image"),b=o.querySelector(".popup__button"),q=n.querySelector(".popup__button"),E=document.querySelector(".profile__button"),g=n.querySelector(".popup__form"),L=document.querySelector("#popupAvatarForm"),k=document.querySelector("#popup-place-name"),C=document.querySelector("#popup-link"),x=document.querySelector("#popup-avatar-link"),A=document.querySelector("#popup-place-submit"),U=document.querySelector("#popup-profile-submit"),D=document.querySelector("#popup-avatar-submit"),P=document.querySelectorAll(".popup__input-error"),T=document.querySelectorAll(".popup__input"),j=(document.fonts.popupForm,{baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"0536b3c2-5810-4220-9c51-ca725c65cff7","Content-Type":"application/json"}});function B(e,t){t.value=e?"Сохранение ...":"Сохранить"}function O(e){"Escape"===e.key&&w(document.querySelector(".popup_opened"))}var w=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",O)},M=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",O)},F=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!1))};function G(e,t){e.forEach((function(e){e.textContent=""})),t.forEach((function(e){e.classList.remove("popup__input_type_error")}))}function N(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var V,z,J=function(){return fetch("".concat(j.baseUrl,"/users/me"),{method:"GET",headers:j.headers}).then((function(e){return N(e)}))},K=function(e){var t=v.querySelector(".place").cloneNode(!0),n=t.querySelector(".place__image"),r=t.querySelector(".place__delete-btn"),c=t.querySelector(".place__like-counter");return n.alt=e.name,n.src=e.link,t.querySelector(".place__title").textContent=e.name,c.textContent=e.likes.length,Q(e.owner._id)||(r.setAttribute("disabled",!1),r.classList.add("place__delete-btn_inactive")),e.likes.some((function(e){return Q(e._id)}))&&t.querySelector(".place__like-btn").classList.add("place__like-btn_active"),t.querySelector(".place__like-btn").addEventListener("click",(function(t){t.target.classList.toggle("place__like-btn_active"),t.target.classList.contains("place__like-btn_active")?H(!0,e,c):H(!1,e,c)})),n.addEventListener("click",(function(){h.textContent=e.name,S.alt=e.name,S.src=e.link,M(o)})),r.addEventListener("click",(function(){t.remove(),I(e)})),t};function Q(e){return J().then((function(e){V=e._id})),e===V}function H(e,t,n){var o;e?(o=t._id,fetch("".concat(j.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:j.headers}).then((function(e){return N(e)}))).then((function(e){n.textContent=e.likes.length,console.log(e)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(j.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:j.headers}).then((function(e){return N(e)}))}(t._id).then((function(e){n.textContent=e.likes.length,console.log(e)})).catch((function(e){console.log(e)}))}function I(e){var t;(t=e._id,fetch("".concat(j.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:j.headers}).then((function(e){return N(e)}))).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}J().then((function(e){return console.log(e)})),J().then((function(e){l.textContent=e.name,s.textContent=e.about,d.src=e.avatar,p.textContent=e._id})).catch((function(e){console.log(e)})),a.addEventListener("submit",(function(e){e.preventDefault(),B(!0,U),sendProfileData(_.value,m.value).then((function(e){l.textContent=_.value,s.textContent=m.value,console.log(e),w(t)})).catch((function(e){console.log(e)})).finally((function(){B(!1,U)}))})),g.addEventListener("submit",(function(e){var t,o;e.preventDefault(),B(!0,A),(t=k.value,o=C.value,fetch("".concat(j.baseUrl,"/cards"),{method:"POST",headers:j.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return N(e)}))).then((function(e){return e})).then((function(e){var t,o,r={};r.name=k.value,r.link=C.value,t=y,o=K(e),t.prepend(o),w(n)})).catch((function(e){console.log(e)}))})),u.addEventListener("click",(function(){return w(t)})),i.addEventListener("click",(function(){G(P,T),B(!1,U),M(t),_.value=l.textContent,m.value=s.textContent})),q.addEventListener("click",(function(){return w(n)})),E.addEventListener("click",(function(){var e;G(P,T),B(!1,A),k.value="",C.value="",M(n),(e=A).setAttribute("disabled",!1),e.classList.add("popup__submit_inactive")})),f.addEventListener("click",(function(){G(P,T),B(!1,D),M(r)})),c.addEventListener("click",(function(){return w(r)})),b.addEventListener("click",(function(){return w(o)})),L.addEventListener("submit",(function(e){e.preventDefault(),B(!0,D),changeProfileAvatar(x.value).then((function(e){d.src=x.value,console.log(e),w(r)})).catch((function(e){console.log(e)})).finally((function(){B(!1,D)}))})),z={formSelector:".popup__inputs",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(z.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);F(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),F(n,o,t)}))}))}(e,z)})),fetch("".concat(j.baseUrl,"/cards"),{method:"GET",headers:j.headers}).then((function(e){return N(e)})).then((function(e){e.forEach((function(e){return t=y,n=K(e),void t.append(n);var t,n}))})).catch((function(e){console.log(e)}))})();